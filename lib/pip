#!/usr/bin/env bash

_dir="$(dirname "$(realpath "${BASH_SOURCE[0]}")")"

# shellcheck source=./lib/helpers
source "$_dir"/helpers

log() {
	log_with_component pip "$@"
}

log_start 'installing pip tools'

log_start 'installing packages'
pip_packages=(
	b2                # Backblaze B2 CLI
	csvkit            # CSV processing tools
	homeassistant-cli # Home Assistant management tool
	yq                # jq for YAML/XML
	yt-dlp            # Media downloader
)

for package in "${pip_packages[@]}"; do
	pipx install "$package" >/dev/null
done
log_end

log_start 'removing no-longer-needed packages'
no_longer_needed_pip_packages=(
	khal                 # Calendar CLI
	visidata             # Data set visualizer
	vdirsyncer           # Synchronize calendars and contacts
	'vdirsyncer[google]' # Extension for Google support
	youtube-dl           # Inactive media downloader
)

for package in "${no_longer_needed_pip_packages[@]}"; do
	pipx uninstall "$package" >/dev/null || true
done
log_end

if is_linux; then
	log_start 'installing rofimoji'
	pipx install rofimoji >/dev/null
	log_end
fi

log_end
