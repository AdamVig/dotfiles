#!/usr/bin/env bash

# shellcheck source=./lib/helpers
source "${BASH_SOURCE[0]%/*}/helpers"

log() {
	log_with_component main "$@"
}

# Ask for password at start
# shellcheck disable=SC2119
request_sudo

"$script_dir"/config

log_start 'running OS-specific scripts'

if is_devcontainer; then
	"$script_dir"/devcontainer
	"$script_dir"/emacs
	"$script_dir"/gh
	"$script_dir"/zsh
	exit
elif is_macos; then
	"$script_dir"/macos
	"$script_dir"/brew
elif is_linux; then
	"$script_dir"/linux-software
	"$script_dir"/flatpak
	if command -v apt >/dev/null; then
		"$script_dir"/apt
	fi
	"$script_dir"/grub
	if is_ubuntu; then
		"$script_dir"/ubuntu
		"$script_dir"/gnome
		"$script_dir"/gnome-theme
	fi
	"$script_dir"/dns
	if is_ubuntu || is_debian; then
		"$script_dir"/remote-management
	fi
fi

log_end

log_start 'running programming language setup scripts'
"$script_dir"/golang
"$script_dir"/node
"$script_dir"/python-tools
log_end

log_start 'running application setup scripts'
"$script_dir"/bat
"$script_dir"/emacs
"$script_dir"/git
"$script_dir"/gh
"$script_dir"/gpg
"$script_dir"/ssh
"$script_dir"/vscode
"$script_dir"/zsh
log_end

log_start 'running system setup scripts'
"$script_dir"/profile-picture
"$script_dir"/ssh-key
"$script_dir"/gpg-keys
log_end

log "done. start a new login shell or run 'source zsh/.zshrc'."
